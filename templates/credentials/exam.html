{% extends "credentials/base_exam.html" %}

{% block title %}Canonical Credentials -- Exam{% endblock %}

{% block meta_description %}
  The Canonical Ubuntu Essentials exams certify knowledge and verify skills in general Linux, Ubuntu Desktop, and Ubuntu Server topics.
{% endblock meta_description %}

{% block meta_copydoc %}
  https://docs.google.com/document/d/1QuhO-9FEOGLrYp8bErS_9snqdljl7d6tFAUoNQxoVDQ/edit
{% endblock meta_copydoc %}

{% block content %}

  <section class="p-strip u-no-padding">
    <iframe title="Exam"
            allow="microphone;camera;display-capture"
            allowusermedia
            class="u-no-margin"
            id="exam-iframe"
            onload="setIframeHeight()"
            scrolling="yes"
            width="100%"
            src="{{ url }}"></iframe>
  </section>

  <script>
    const examUrl = "{{ exam_url }}";
    const setIframeHeight = () => {
      // TODO: Account for header height change
      const navHeight = document.getElementById("navigation").clientHeight;
      const container = document.getElementById("exam-iframe");
      container.style.height = `${window.innerHeight - navHeight - 32 - 4}px`;
    }

    window.onresize = setIframeHeight;

    const refocusIframe = () => {
      console.log("refocusIframe");
      const outerIframe = document.getElementById('exam-iframe');
      const innerIframe = outerIframe.contentWindow.document.getElementById('lazy_loaded_iframe');
      if (innerIframe) {
        innerIframe.contentWindow.focus();
      }
    }

    const addEventListeners = () => {
      const outerIframe = document.getElementById('exam-iframe');
      if (outerIframe) {
        outerIframe.addEventListener('load', refocusIframe);
        outerIframe.addEventListener('click', refocusIframe);
      }
    }

    document.addEventListener("DOMContentLoaded", addEventListeners);
  </script>

{% endblock content %}
